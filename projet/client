import java.io.*;
import java.net.*;
import java.util.ArrayList;
import java.util.Scanner;

public class ClientTCP {

    public static void main(String[] args) throws IOException {

        if (args.length<2) {
            System.out.println("Saisir le serveur et le port");
        }
        Scanner scanner =  new Scanner(System.in);

        InetSocketAddress adress = new InetSocketAddress(12345);
        Socket s = new Socket();
        s.connect(adress);
        System.out.print("Welcome, choose a username :");
        String username = scanner.nextLine();

        int request;
        String message;

        do {
            System.out.println("What do you want to do ?");
            System.out.println("1-PUBLISH");
            System.out.println("2-Receive IDs");
            request = Integer.parseInt(scanner.nextLine());
            System.out.println(request);
        } while (request != 1 && request!=2);

        if (request==1) message ="PUBLISH@"+username;
        else if (request==2) message ="RCV_IDS@"+username;
        else message ="@"+username;


        while(scanner.hasNextLine()){
            String textImput = scanner.nextLine()+"\n";
            message =message+"#"+textImput;
            DataOutputStream os = new DataOutputStream(s.getOutputStream());
            System.out.println(message);
            os.writeUTF(message);
            message="";
            BufferedReader in = new BufferedReader(new InputStreamReader(s.getInputStream()));
            String response = in.readLine(); // Lire la rÃ©ponse
            System.out.println(response);
        }
    }
}
